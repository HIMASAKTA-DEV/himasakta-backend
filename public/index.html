<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HIMASAKTA API Docs</title>
  <style>
    :root {
      --primary: #2563eb;
      --bg: #f8fafc;
      --surface: #ffffff;
      --text: #1e293b;
      --border: #e2e8f0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px;
      line-height: 1.5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      margin-bottom: 40px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 20px;
    }

    h1 {
      margin: 0;
      font-size: 2rem;
      color: var(--primary);
    }

    .grid {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 20px;
      align-items: start;
    }

    .nav {
      background: var(--surface);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 20px;
    }

    .nav button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 10px;
      background: none;
      border: none;
      cursor: pointer;
      border-radius: 4px;
      color: var(--text);
      font-weight: 500;
    }

    .nav button:hover {
      background-color: #f1f5f9;
    }

    .nav button.active {
      background-color: #eff6ff;
      color: var(--primary);
    }

    .content {
      background: var(--surface);
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .endpoint {
      margin-bottom: 30px;
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }

    .endpoint-header {
      padding: 15px;
      background: #f8fafc;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      font-family: monospace;
      font-size: 0.9em;
    }

    .method {
      padding: 4px 8px;
      border-radius: 4px;
      color: white;
      font-size: 0.8em;
    }

    .GET {
      background-color: #3b82f6;
    }

    .POST {
      background-color: #22c55e;
    }

    .PUT {
      background-color: #f59e0b;
    }

    .DELETE {
      background-color: #ef4444;
    }

    .endpoint-body {
      padding: 20px;
    }

    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 0.85em;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 0.9em;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-family: inherit;
    }

    button.action-btn {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }

    button.action-btn:hover {
      opacity: 0.9;
    }

    .auth-section {
      background: #eff6ff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #dbeafe;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>HIMASAKTA API Playground</h1>
      <p>Interactive documentation for testing API endpoints.</p>
      <div class="auth-section">
        <h3>Authentication</h3>
        <div class="form-group">
          <label>Token (JWT)</label>
          <input type="text" id="authToken" placeholder="Enter Bearer token here..."
            onchange="localStorage.setItem('token', this.value)">
        </div>
        <p style="font-size: 0.8em; color: #64748b;">Get token via POST /api/v1/auth/login first.</p>
      </div>
    </header>

    <div class="grid">
      <nav class="nav" id="nav"></nav>
      <main class="content" id="main"></main>
    </div>
  </div>

  <script>
    const API_URL = '/api/v1';

    const routes = [
      {
        name: "Authentication",
        endpoints: [
          { method: "POST", path: "/auth/login", desc: "Superadmin Login", body: { username: "admin", password: "admin" } }
        ]
      },
      {
        name: "Role", // NEW Section
        endpoints: [
          { method: "GET", path: "/role", desc: "List Roles", query: ["page", "limit", "name"] },
          { method: "POST", path: "/role", desc: "Create Role", body: { name: "Kahima", level: 1, description: "Ketua Himpunan" } },
          { method: "GET", path: "/role/:id", desc: "Get Role by ID", params: ["id"] },
          { method: "PUT", path: "/role/:id", desc: "Update Role", params: ["id"], body: { name: "Kahima Updated", level: 1 } },
          { method: "DELETE", path: "/role/:id", desc: "Delete Role", params: ["id"] }
        ]
      },
      {
        name: "Member",
        endpoints: [
          { method: "GET", path: "/member", desc: "List Members", query: ["page", "limit", "name", "groupby"] }, // Added groupby
          { method: "POST", path: "/member", desc: "Create Member", body: { nrp: "500...", name: "John", role_id: "uuid...", cabinet_id: "uuid...", index: 1, department_id: "uuid..." } }, // Updated body
          { method: "GET", path: "/member/:id", desc: "Get Member by ID", params: ["id"] },
          { method: "PUT", path: "/member/:id", desc: "Update Member", params: ["id"], body: { name: "John Doe", index: 2 } },
          { method: "DELETE", path: "/member/:id", desc: "Delete Member", params: ["id"] }
        ]
      },
      {
        name: "Cabinet Info",
        endpoints: [
          { method: "GET", path: "/cabinet-info", desc: "List Cabinets", query: ["page", "limit"] },
          { method: "GET", path: "/current-cabinet", desc: "Get Current Active Cabinet" },
          { method: "POST", path: "/cabinet-info", desc: "Create Cabinet", body: { visi: "...", misi: "...", period_start: "2024-01-01", period_end: "2024-12-31", tagline: "..." } },
          { method: "GET", path: "/cabinet-info/:id", desc: "Get Cabinet by ID", params: ["id"] },
          { method: "PUT", path: "/cabinet-info/:id", desc: "Update Cabinet", params: ["id"], body: { visi: "Updated Visi" } },
          { method: "DELETE", path: "/cabinet-info/:id", desc: "Delete Cabinet", params: ["id"] }
        ]
      },
      {
        name: "Department",
        endpoints: [
          { method: "GET", path: "/department", desc: "List Departments", query: ["page", "limit", "name"] },
          { method: "POST", path: "/department", desc: "Create Department", body: { name: "Kominfo", description: "Design & IT" } },
          { method: "GET", path: "/department/:name", desc: "Get Department by Name/ID", params: ["name"] },
          { method: "PUT", path: "/department/:id", desc: "Update Department", params: ["id"], body: { description: "Updated Desc" } },
          { method: "DELETE", path: "/department/:id", desc: "Delete Department", params: ["id"] }
        ]
      },
      {
        name: "News",
        endpoints: [
          { method: "GET", path: "/news", desc: "List News", query: ["page", "limit", "search", "category"] },
          { method: "GET", path: "/news/autocompletion", desc: "Title Autocomplete", query: ["search"] },
          { method: "POST", path: "/news", desc: "Create News", body: { title: "New Event", content: "Details...", published_at: new Date().toISOString() } },
          { method: "GET", path: "/news/:slug", desc: "Get News by Slug", params: ["slug"] },
          { method: "PUT", path: "/news/:id", desc: "Update News", params: ["id"], body: { title: "Updated Title" } },
          { method: "DELETE", path: "/news/:id", desc: "Delete News", params: ["id"] }
        ]
      },
      {
        name: "Monthly Event",
        endpoints: [
          { method: "GET", path: "/monthly-event", desc: "List Events", query: ["page", "limit", "title"] },
          { method: "GET", path: "/monthly-event/this-month", desc: "Get Events This Month" },
          { method: "POST", path: "/monthly-event", desc: "Create Event", body: { title: "Gathering", month: new Date().toISOString(), description: "..." } },
          { method: "GET", path: "/monthly-event/:id", desc: "Get Event by ID", params: ["id"] },
          { method: "PUT", path: "/monthly-event/:id", desc: "Update Event", params: ["id"], body: { title: "Updated Event" } },
          { method: "DELETE", path: "/monthly-event/:id", desc: "Delete Event", params: ["id"] }
        ]
      },
      {
        name: "Progenda",
        endpoints: [
          { method: "GET", path: "/progenda", desc: "List Progenda", query: ["page", "limit", "search", "department_id"] },
          { method: "POST", path: "/progenda", desc: "Create Progenda", body: { name: "New Proker", goal: "...", description: "...", department_id: "uuid..." } },
          { method: "GET", path: "/progenda/:id", desc: "Get Progenda by ID", params: ["id"] },
          { method: "PUT", path: "/progenda/:id", desc: "Update Progenda", params: ["id"], body: { name: "Updated Proker" } },
          { method: "DELETE", path: "/progenda/:id", desc: "Delete Progenda", params: ["id"] }
        ]
      },
      {
        name: "Gallery",
        endpoints: [
          { method: "GET", path: "/gallery", desc: "List Gallery", query: ["page", "limit", "caption"] },
          { method: "POST", path: "/gallery", desc: "Upload Image", isUpload: true },
          { method: "GET", path: "/gallery/:id", desc: "Get Gallery by ID", params: ["id"] },
          { method: "PUT", path: "/gallery/:id", desc: "Update Gallery", params: ["id"], body: { caption: "Updated Caption" } },
          { method: "DELETE", path: "/gallery/:id", desc: "Delete Gallery", params: ["id"] }
        ]
      },
      {
        name: "NRP Whitelist",
        endpoints: [
          { method: "POST", path: "/nrp-whitelist", desc: "Check NRP", body: { nrp: "500..." } },
          { method: "POST", path: "/nrp-whitelist/add", desc: "Add NRP (Admin)", body: { nrp: "500..." } },
          { method: "DELETE", path: "/nrp-whitelist/:id", desc: "Delete NRP", params: ["id"] }
        ]
      }
    ];

    // Init
    document.getElementById('authToken').value = localStorage.getItem('token') || '';
    renderNav();
    renderSection(0);

    function renderNav() {
      const nav = document.getElementById('nav');
      nav.innerHTML = routes.map((section, idx) =>
        `<button onclick="renderSection(${idx})" class="${idx === 0 ? 'active' : ''}">${section.name}</button>`
      ).join('');
    }

    function renderSection(idx) {
      document.querySelectorAll('.nav button').forEach((b, i) => b.classList.toggle('active', i === idx));
      const section = routes[idx];
      const main = document.getElementById('main');

      main.innerHTML = `<h2>${section.name}</h2>` + section.endpoints.map((ep, i) => {
        const id = `ep-${idx}-${i}`;
        return `
                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method ${ep.method}">${ep.method}</span>
                        <span>${ep.path}</span>
                        <span style="margin-left:auto; color:#64748b">${ep.desc}</span>
                    </div>
                    <div class="endpoint-body">
                        ${renderInputs(ep, id)}
                        <button class="action-btn" onclick="execute('${id}')">Execute</button>
                        <div id="res-${id}" style="margin-top:15px; display:none;">
                            <label>Response:</label>
                            <pre></pre>
                        </div>
                    </div>
                </div>`;
      }).join('');
    }

    function renderInputs(ep, id) {
      let html = '';

      if (ep.params) {
        ep.params.forEach(p => {
          html += `<div class="form-group"><label>URL Param: ${p}</label><input type="text" id="param-${id}-${p}" placeholder="${p}"></div>`;
        });
      }

      if (ep.query) {
        html += `<div class="form-group"><label>Query Params</label><div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">`;
        ep.query.forEach(q => {
          html += `<input type="text" id="query-${id}-${q}" placeholder="${q}">`;
        });
        html += `</div></div>`;
      }

      if (ep.isUpload) {
        html += `
                <div class="form-group"><label>Image File</label><input type="file" id="file-${id}"></div>
                <div class="form-group"><label>Caption</label><input type="text" id="data-${id}-caption"></div>
                <div class="form-group"><label>Category</label><input type="text" id="data-${id}-category"></div>
                <div class="form-group"><label>Department ID</label><input type="text" id="data-${id}-department_id"></div>
                <div class="form-group"><label>Progenda ID</label><input type="text" id="data-${id}-progenda_id"></div>
                <div class="form-group"><label>Cabinet ID</label><input type="text" id="data-${id}-cabinet_id"></div>
                `;
      } else if (ep.body) {
        html += `<div class="form-group"><label>Request Body (JSON)</label>
                <textarea id="body-${id}" rows="5">${JSON.stringify(ep.body, null, 2)}</textarea></div>`;
      }

      return html;
    }

    async function execute(id) {
      const [sectionIdx, epIdx] = id.split('-').slice(1).map(Number);
      const ep = routes[sectionIdx].endpoints[epIdx];

      let url = API_URL + ep.path;

      // Params
      if (ep.params) {
        ep.params.forEach(p => {
          const val = document.getElementById(`param-${id}-${p}`).value;
          url = url.replace(`:${p}`, val);
        });
      }

      // Query
      const queryParts = [];
      if (ep.query) {
        ep.query.forEach(q => {
          const val = document.getElementById(`query-${id}-${q}`).value;
          if (val) queryParts.push(`${q}=${encodeURIComponent(val)}`);
        });
      }
      if (queryParts.length) url += '?' + queryParts.join('&');

      const options = {
        method: ep.method,
        headers: {
          'Authorization': 'Bearer ' + (localStorage.getItem('token') || '')
        }
      };

      // Body
      if (ep.isUpload) {
        const formData = new FormData();
        const fileInput = document.getElementById(`file-${id}`);
        if (fileInput.files[0]) formData.append('image', fileInput.files[0]);

        ['caption', 'category', 'department_id', 'progenda_id', 'cabinet_id'].forEach(f => {
          const val = document.getElementById(`data-${id}-${f}`).value;
          if (val) formData.append(f, val);
        });
        options.body = formData;
      } else if (ep.body) {
        try {
          const bodyVal = document.getElementById(`body-${id}`).value;
          options.body = bodyVal; // raw string
          options.headers['Content-Type'] = 'application/json';
        } catch (e) {
          alert('Invalid JSON');
          return;
        }
      }

      try {
        const res = await fetch(url, options);
        const data = await res.json();
        const resDiv = document.getElementById(`res-${id}`);
        resDiv.style.display = 'block';
        resDiv.querySelector('pre').textContent = JSON.stringify(data, null, 2);

        if (data.data?.token) {
          localStorage.setItem('token', data.data.token);
          document.getElementById('authToken').value = data.data.token;
        }
      } catch (err) {
        alert('Request failed: ' + err.message);
      }
    }
  </script>
</body>

</html>